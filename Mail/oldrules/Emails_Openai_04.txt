EMAILS_OpenAI_04 – Sorting Blueprint (12 Feb 2026)

SCOPE
- Account: rafaelfelixremy@gmail.com
- Maildir root: /home/rafael/Mail/gmail/
- Active sources: INBOX.sort_ai_correction/cur (always first), then INBOX/new, then INBOX/cur.
- Moves are destructive (mv). Never copy, back up, or sync.
- After each mv, immediately run `ls` on source + destination; if the file still exists in its source folder, repeat the mv until it disappears.
- Finish only when all three sources contain zero files.
- Every run writes one log at /home/rafael/OPENCLAW_FUNKTIONEN/LOGS/$TIMESTAMP.md with summaries + mv directives.

RUN FLOW
0. **Correction pool first:** For every file in INBOX.sort_ai_correction/cur, run `grep -R "<filename>" /home/rafael/OPENCLAW_FUNKTIONEN/LOGS` to see earlier reasoning before re-sorting.
1. Count files in correction + INBOX/new + INBOX/cur. If total == 0 ⇒ log "SKIP (alle Quellen leer)" and stop.
2. Otherwise process every file sequentially (correction → new → cur):
   a. Parse headers/body (From, Subject, Date, List-Unsubscribe, human vs automation signals).
   b. Log a 3-sentence summary: from, from_email, date, time, content recap, CTA; include unsubscribe link if present.
   c. Choose destination using the RULE TREE below (ordered). Preserve source subfolder: correction behaves like cur; files from new go into destination/new.
   d. `mv SOURCE DEST`.
   e. `ls SOURCE` (must fail) and `ls DEST | grep FILENAME` (must succeed). Retry mv if needed.
   f. Append `- action: mv SOURCE -> DEST` to the log.
3. Log final counts for correction/new/cur (all must be 0).

RULE TREE (apply in order; first match wins)
1. **AGB / Leistungsänderung** – keywords: "AGB", "terms", "policy update", "service change" → /home/rafael/Mail/gmail/INBOX.Archiv.AGB/
2. **Zahlungs-Bestätigung** – successful charges, receipts, auto-pay confirmations → .../INBOX.Archiv.bezahlt/
3. **Offene Forderung / Fehlerhafte Zahlung** – overdue, invoices due, failed payments, "Mahnung" → .../INBOX.Freitag/
4. **Login / Security / OTP** – sign-in alerts, verification codes, OAuth approvals, suspicious login, password resets → .../INBOX.loeschen/
5. **Welcome / Account Activation** – new service welcomes, "Confirm your email", invitations → .../INBOX.Archiv.welcome/
6. **System-/Provider-Meldungen** – infrastructure/API status updates, quota or limit notices, product update bulletins, GitHub automated notifications, Google/AWS/GCP/OpenAI alerts, billing notices without payment confirmation → /home/rafael/Mail/gmail/INBOX.Archiv.Systemmeldungen/
7. **Human ↔ Human Kommunikation** – ONLY genuine, personal emails written by identifiable people (no unsubscribe/footer, conversational/one-off). If there is any List-Unsubscribe, tracking pixels, mass footer, or noreply sender, this rule does *not* apply. → /home/rafael/Mail/gmail/INBOX.Archiv.Kommunikation/
8. **Newsletter / Automatisierte Kampagnen (DEFAULT)** – marketing blasts, promos, release notes, event invites, product digests, GitHub/Envato/Twilio/Groq/Netdata announcements, anything with List-Unsubscribe or mail-merge tokens. → /home/rafael/Mail/gmail/INBOX.Archiv.newsletter/
9. **Fallback** – if none above fit and classification is unclear → /home/rafael/Mail/gmail/INBOX.sort_ai_uncertain/

NEWSLETTER vs. COMMUNICATION HEURISTICS
- **Newsletter indicators:** `List-Unsubscribe`, "unsubscribe" links, view-in-browser links, tracking parameters, noreply/marketing domains, HTML-heavy templates. All go to INBOX.Archiv.newsletter (rule 8) unless a higher rule already matched.
- **Communication indicators:** Named individual, direct conversational tone, references to previous dialogue, no bulk footer, no unsubscribe, typically plain text. Only such mails go to INBOX.Archiv.Kommunikation (rule 7). When in doubt, assume Newsletter.
- INBOX.sort_ai_correction/ contains previous mistakes—review its log context before re-sorting to avoid repeating errors.

LOG FORMAT EXAMPLE
```
## Subject Line (Service Name)
- from: Foo Service
- from_email: updates@foo.com
- date: Wed, 12 Feb 2026
- time: 15:05:12 +0000
- summary: Satz 1 … Satz 2 … Satz 3 … (inkl. CTA / Kontext). Unsubscribe-Link nennen, falls vorhanden.
- unsubscribe: <link or n/a>
- action: mv /home/.../INBOX/cur/<filename> -> /home/.../INBOX.Archiv.newsletter/cur/
```

END OF FILE
