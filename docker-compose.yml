services:
  sgptmaildir:
    build: .
    container_name: sgptmaildir_sorter
    working_dir: /app
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      # persistent maildir + pdf outputs
      - maildata:/app/Mail
      - ./LOGS:/app/LOGS
      # configs (bind mounts)
      - ./offlineimaprc:/app/offlineimaprc:ro
      - ./rules/rules_custom.json:/app/rules/rules_custom.json:ro
      - ./mirror_dir_gmail.json:/app/mirror_dir_gmail.json:ro
      # sgpt config (project-local)
      - ./sgpt_config.yaml:/app/sgpt_config.yaml:ro
    command: ["/bin/bash", "-lc", "bin/mail_sync.sh gmail && bin/email_sort.sh gmail"]

volumes:
  maildata:
